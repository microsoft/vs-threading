parameters:
- name: EnableLocalization
  type: boolean
  default: false
- name: ShouldSkipOptimize
  type: boolean
  default: false
- name: RealSign
  type: boolean

steps:
- ${{ if ne(variables['Build.Reason'], 'PullRequest') }}:
  # notice@0 requires CG detection to run first, and non-default branches don't inject it automatically.
  # default branch injection (main) is happening too late for notice@0 to run successfully. Adding this as a workaround.
  - task: ComponentGovernanceComponentDetection@0
    displayName: üîç Component Detection

  - task: notice@0
    displayName: üõ†Ô∏è Generate NOTICE file
    inputs:
      outputfile: $(System.DefaultWorkingDirectory)/obj/NOTICE
      outputformat: text
    retryCountOnTaskFailure: 10 # fails when the cloud service is overloaded
    continueOnError: ${{ not(parameters.RealSign) }} # Tolerate failures when we're not building something that may ship.
